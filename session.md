# Session
- 클라이언트 별 정보를 브라우저가 아닌 웹 서버에 저장하는 것이다.
- 클라이언트의 정보를 웹 브라우저에 저장하는 기술을 `cookie`
- `django`의 `session`은 쿠키에는 `sessionld`만을 저장하며, 클라이언트와 웹 서버 간의 연결성을 확보한 뒤 `sessionld`를 통해 커뮤니케이션을 실행한다.
- `session`의 라이프사이클은 브라우저에 의존합니다. 같은 브라우저를 사용하고 있다면 링크를 통해서 다른 사이트로 이동할때도 `sessionId`는 쿠키로써 쭉 유지되고, 브라우저를 닫으면 사라집니다.

# django의 세션의 작동 방식

- 장고 세션은 웹 애플리케이션에서 사용자에 대한 데이터를 서버 측에 저장하는 방법을 제공합니다. 이를 통해 사용자가 웹 사이트와 상호작용하는 동안 지속적으로 상태를 유지할 수 있습니다.

1. 클라이언트(웹 브라우저)가 서버에 요청을 보냅니다.
2. 서버는 요청에 대한 응답으로 클라이언트에게 세션 ID를 할당합니다. 이 세션 ID는 일반적으로 쿠키(cookie)를 사용하여 클라이언트에게 전달됩니다.
3. 클라이언트는 이 세션 ID를 저장하고, 이후 요청에서 세션 ID를 함께 서버에 전달합니다.
4. 서버는 세션 ID를 사용하여 클라이언트에 대한 세션 데이터를 식별하고 관리합니다.
5. 세션 데이터는 서버 측에 저장되며, 일반적으로 데이터베이스 또는 캐시 등을 이용하여 지속적으로 보관됩니다.
6. 클라이언트가 추가 요청을 보낼 때마다, 서버는 세션 ID를 통해 해당 클라이언트의 세션 데이터를 검색하여 사용자의 상태 및 정보를 유지합니다.
7. 세션 데이터는 클라이언트의 요청이 완료되면 서버 측에서 관리되며, 클라이언트는 세션 ID를 저장하고 다음 요청에서 다시 전달합니다.

# 세션 사용하기
- 세션은 장고의 `middleware` 를 통해 실행됩니다. 
- 세션 기능을 시작하려면 `settings.py`의  MIDDLEWARE_CLASSES 에 'django.contrib.sessions.middleware.SessionMiddleware' 를 추가해줍니다. ( default로 설정되어 있다.)

# 세션 엔진 설정하기

- 크게 나누어서
1. 데이터베이스를 사용하는 세션(장고 default)
2. 캐시를 사용하는 세션
3. 파일을 사용하는 세션
4. 쿠키를 사용하는 세션

## '데이터베이스를 사용하는 세션'
- `INSTALLED_APPS`에 `'django.contrib.sessions'`를 추가

# view에서 세션 사용하기
- `SessionMiddleware`가 실행되면, 모든 장고 view 함수에서 첫번째 인자값으로 전달되는 `HttpRequest`들은 `모두 session 속성을 가지게 된다`. `사전형식`으로 되어있다.
- `view의 어느 곳에서라도 request.session`을 통해 `수정`하고 `읽을 수 있다`.

## 추가
-  SESSION_EXPIRE_AT_BROWSER_CLOSE 가 False 로 기본 설정되어있다. 즉 브라우저를 꺼도, 설정된 expire(만기) 만큼 세션이 남아 있다. True 로 바꿔주면 브라우저를 닫으면 바로 세션이 사라진다. 크롬같은 경우에는 브라우저를 꺼도 세션이 남아있을 수도 있다.

# 예시
```python
cart = request.session.get('cart', {})
```
-  세션에서 'cart'라는 키에 해당하는 값을 가져온다. 이 때, 세션에 'cart' 키가 존재하지 않을 경우에는 빈 딕셔너리 {}를 반환한다. 

## 추가
- 실제로, 장고의 기본 세션 백엔드는 데이터베이스를 사용하여 세션 데이터를 저장하도록 설정되어 있다. 이를 위해 django_session 테이블이 데이터베이스에 생성된다. 따라서, 세션을 사용하는 경우에는 기본적으로 장고의 세션 메커니즘을 통해 세션 데이터가 데이터베이스에 저장되고 관리된다.
- 장바구니에 추가한 제품들은 `django_session 테이블`에 `저장`되는 `세션 데이터`로 `저장`된다. 이는 `임시적이고 일시적인 상태`로 관리되는 데이터이며, 사용자 세션에 종속적입니다. `사용자가 로그아웃`하거나 `세션이 만료`되면 해당 `세션 데이터는 삭제`됩니다.